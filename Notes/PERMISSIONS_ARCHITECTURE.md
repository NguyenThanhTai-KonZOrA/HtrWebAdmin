# ğŸ¨ Há»‡ Thá»‘ng PhÃ¢n Quyá»n - Visual Architecture

## ğŸ“Š System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER LOGIN                                 â”‚
â”‚                               â†“                                     â”‚
â”‚                    Backend Returns JWT Token                        â”‚
â”‚                    (contains role claim)                            â”‚
â”‚                               â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              AuthContext (src/contexts/AuthContext.tsx)    â”‚    â”‚
â”‚  â”‚  â€¢ Stores: user, token, role                              â”‚    â”‚
â”‚  â”‚  â€¢ Parses JWT to extract role                             â”‚    â”‚
â”‚  â”‚  â€¢ Provides: login(), logout(), user, token, role         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚       Constants & Mappings (src/constants/roles.ts)        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚   UserRole      â”‚  â”‚     Permission           â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ ADMIN        â”‚  â”‚  â€¢ VIEW_ADMIN_REG        â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ USER         â”‚  â”‚  â€¢ VIEW_DEVICE_MAPPING   â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ EDIT_DEVICE_MAPPING   â”‚        â”‚    â”‚
â”‚  â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                               â†“                            â”‚    â”‚
â”‚  â”‚               ROLE_PERMISSIONS Mapping                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚    â”‚
â”‚  â”‚  â”‚  Admin â†’ [ALL_PERMISSIONS]                     â”‚       â”‚    â”‚
â”‚  â”‚  â”‚  User  â†’ [VIEW_ADMIN_REG]                      â”‚       â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚       usePermission Hook (src/hooks/usePermission.ts)      â”‚    â”‚
â”‚  â”‚  â€¢ can(permission) â†’ boolean                              â”‚    â”‚
â”‚  â”‚  â€¢ canAny([permissions]) â†’ boolean                        â”‚    â”‚
â”‚  â”‚  â€¢ canAll([permissions]) â†’ boolean                        â”‚    â”‚
â”‚  â”‚  â€¢ isAdmin() â†’ boolean                                    â”‚    â”‚
â”‚  â”‚  â€¢ hasRole(role) â†’ boolean                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â†“                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â†“                                           â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RoleBasedRoute  â”‚                    â”‚  PermissionGuard    â”‚  â”‚
â”‚  â”‚  (Page Level)    â”‚                    â”‚  (UI Element Level) â”‚  â”‚
â”‚  â”‚                  â”‚                    â”‚                     â”‚  â”‚
â”‚  â”‚  â€¢ Protects      â”‚                    â”‚  â€¢ Shows/Hides UI   â”‚  â”‚
â”‚  â”‚    routes        â”‚                    â”‚  â€¢ Conditional      â”‚  â”‚
â”‚  â”‚  â€¢ Shows Access  â”‚                    â”‚    rendering        â”‚  â”‚
â”‚  â”‚    Denied page   â”‚                    â”‚  â€¢ Fallback support â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagrams

### Flow 1: Admin Login to Page Access

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Login      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Backend  â”‚
â”‚  User    â”‚                â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                             JWT Token
                          (role = "Admin")
                                  â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ AuthContext  â”‚
                          â”‚ stores role  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ROLE_PERMISSIONS      â”‚
                    â”‚  Admin â†’ [ALL]         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                 â”‚
        â†“                                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SideNav     â”‚                              â”‚   App Routes    â”‚
â”‚ Shows 2 items: â”‚                              â”‚                 â”‚
â”‚ â€¢ Registration â”‚                              â”‚ /admin-device-  â”‚
â”‚ â€¢ Device Map   â”‚                              â”‚ mapping allowed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â†“
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ DeviceMappingPage   â”‚
                                              â”‚ âœ… Rendered         â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 2: User Trying to Access Restricted Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Login      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Normal  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Backend  â”‚
â”‚  User    â”‚                â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                             JWT Token
                           (role = "User")
                                  â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ AuthContext  â”‚
                          â”‚ stores role  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ROLE_PERMISSIONS      â”‚
                    â”‚  User â†’ [LIMITED]      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                 â”‚
        â†“                                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SideNav     â”‚                              â”‚   App Routes    â”‚
â”‚ Shows 1 item:  â”‚                              â”‚                 â”‚
â”‚ â€¢ Registration â”‚        User pastes URL       â”‚ RoleBasedRoute  â”‚
â”‚                â”‚        /admin-device-mapping â”‚ checks perms    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â†“
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ Permission Check:   â”‚
                                              â”‚ VIEW_DEVICE_MAPPING â”‚
                                              â”‚ âŒ DENIED           â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â†“
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ Access Denied Page  â”‚
                                              â”‚ ğŸ”’ Displayed        â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Component Structure

```
src/
â”‚
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ roles.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â€¢ UserRole                    â”‚
â”‚       â€¢ Permission                  â”‚  Core Definitions
â”‚       â€¢ ROLE_PERMISSIONS            â”‚
â”‚       â€¢ Helper functions            â”‚
â”‚                                     â”‚
â”œâ”€â”€ hooks/                            â”‚
â”‚   â””â”€â”€ usePermission.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚       Uses AuthContext           â”‚  â”‚
â”‚       Uses roles.ts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
â”‚                                  â”‚
â”œâ”€â”€ components/                    â”‚
â”‚   â”‚                              â”‚
â”‚   â”œâ”€â”€ RoleBasedRoute.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”‚   â€¢ Uses AuthContext         â”‚  Protection Layer
â”‚   â”‚   â€¢ Uses usePermission â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚   â€¢ Protects Routes
â”‚   â”‚
â”‚   â”œâ”€â”€ PermissionGuard.tsx â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â€¢ Uses usePermission â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚   â€¢ Hides/Shows UI
â”‚   â”‚
â”‚   â”œâ”€â”€ ProtectedRoute.tsx
â”‚   â”‚   â€¢ Uses AuthContext
â”‚   â”‚   â€¢ Checks authentication
â”‚   â”‚
â”‚   â””â”€â”€ layout/
â”‚       â””â”€â”€ SideNav.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â€¢ Uses usePermission â”€â”˜
â”‚           â€¢ Filters menu items
â”‚
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx
â”‚       â€¢ Stores user, token, role
â”‚       â€¢ Provides auth state
â”‚
â””â”€â”€ App.tsx
    â€¢ Uses RoleBasedRoute
    â€¢ Configures protected routes
```

---

## ğŸ¯ Permission Check Flow

```
Component needs to check permission
            â†“
    Calls usePermission()
            â†“
    Gets current role from AuthContext
            â†“
    Looks up ROLE_PERMISSIONS[role]
            â†“
    Checks if permission is in list
            â†“
    Returns true/false
            â†“
Component renders accordingly
```

---

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 1                          â”‚
â”‚               Frontend Protection                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ ProtectedRoute (Auth check)             â”‚    â”‚
â”‚  â”‚  â€¢ RoleBasedRoute (Permission check)       â”‚    â”‚
â”‚  â”‚  â€¢ PermissionGuard (UI visibility)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                    PURPOSE: UX                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                    HTTP Request
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 2                          â”‚
â”‚                Backend Protection                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ JWT Token Validation                    â”‚    â”‚
â”‚  â”‚  â€¢ Role Verification                       â”‚    â”‚
â”‚  â”‚  â€¢ Permission Authorization                â”‚    â”‚
â”‚  â”‚  â€¢ API Endpoint Guards                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                  PURPOSE: SECURITY                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš ï¸ CRITICAL: Both layers are needed!**
- Frontend = Better UX
- Backend = Real Security

---

## ğŸ“± User Experience Flow

### Admin User Journey

```
Login (role=Admin)
       â†“
   Dashboard
       â†“
   Sidebar Menu:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ âœ… Registration     â”‚ â† Visible
   â”‚ âœ… Device Mapping   â”‚ â† Visible
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
   Clicks "Device Mapping"
       â†“
   âœ… Access Granted
       â†“
   Device Mapping Page
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ View Settings     â”‚
   â”‚ â€¢ Edit Settings     â”‚
   â”‚ â€¢ Delete Settings   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Normal User Journey

```
Login (role=User)
       â†“
   Dashboard
       â†“
   Sidebar Menu:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ âœ… Registration     â”‚ â† Visible
   â”‚                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   (Device Mapping NOT shown)
       â†“
   Tries to paste URL:
   /admin-device-mapping
       â†“
   âŒ Access Denied
       â†“
   Access Denied Page
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚      ğŸ”’             â”‚
   â”‚  Access Denied      â”‚
   â”‚                     â”‚
   â”‚ [Go Home] [Go Back] â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Extension Pattern

### Adding New Permission

```
1. Define Permission
   â†“
   constants/roles.ts
   Permission.NEW_PERMISSION = 'new_permission'

2. Add to Role Mapping
   â†“
   ROLE_PERMISSIONS[UserRole.ADMIN].push(
     Permission.NEW_PERMISSION
   )

3. Use in Component
   â†“
   <RoleBasedRoute 
     requiredPermission={Permission.NEW_PERMISSION}
   >
     <NewPage />
   </RoleBasedRoute>

4. Done! âœ…
```

---

## ğŸ¨ Component Usage Patterns

### Pattern 1: Route Protection

```tsx
App.tsx
   â†“
<Route path="/page" element={
  <ProtectedRoute>          â† Auth Layer
    <RoleBasedRoute          â† Permission Layer
      requiredPermission={Permission.VIEW}
    >
      <MyPage />             â† Your Component
    </RoleBasedRoute>
  </ProtectedRoute>
} />
```

### Pattern 2: UI Element Protection

```tsx
MyComponent.tsx
   â†“
<PermissionGuard requiredPermission={Permission.EDIT}>
  <Button>Edit</Button>      â† Only shown if has permission
</PermissionGuard>

<Button>View</Button>        â† Always shown (no guard)
```

### Pattern 3: Conditional Logic

```tsx
MyComponent.tsx
   â†“
const { can, isAdmin } = usePermission();

if (can(Permission.DELETE)) {
  showDeleteButton();        â† Conditional rendering
}

if (isAdmin()) {
  showAdminPanel();          â† Admin-only logic
}
```

---

## ğŸ“Š State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          localStorage                     â”‚
â”‚  â€¢ token                                  â”‚
â”‚  â€¢ user                                   â”‚
â”‚  â€¢ userRole                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
         (persist/hydrate)
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          AuthContext State                â”‚
â”‚  â€¢ user: string | null                    â”‚
â”‚  â€¢ token: string | null                   â”‚
â”‚  â€¢ role: string | null                    â”‚
â”‚  â€¢ isLoading: boolean                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
         (consumed by)
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       usePermission Hook                  â”‚
â”‚  â€¢ Reads role from AuthContext            â”‚
â”‚  â€¢ Provides permission checks             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†•
         (used by)
                   â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Components                          â”‚
â”‚  â€¢ RoleBasedRoute                         â”‚
â”‚  â€¢ PermissionGuard                        â”‚
â”‚  â€¢ SideNav                                â”‚
â”‚  â€¢ etc.                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Decision Tree

```
User tries to access a route
         â”‚
         â”œâ”€â†’ Has token? â”€â”€NOâ”€â”€â†’ Redirect to Login
         â”‚
         YES
         â”‚
         â”œâ”€â†’ Route has RoleBasedRoute? â”€â”€NOâ”€â”€â†’ Allow access
         â”‚
         YES
         â”‚
         â”œâ”€â†’ Check permission
         â”‚
         â”œâ”€â†’ Has required permission? â”€â”€NOâ”€â”€â†’ Show Access Denied
         â”‚
         YES
         â”‚
         â””â”€â†’ âœ… Render page
```

---

**CÃ¡c diagrams nÃ y giÃºp visualize cÃ¡ch há»‡ thá»‘ng hoáº¡t Ä‘á»™ng!**

Xem code thá»±c táº¿ táº¡i:
- `src/constants/roles.ts`
- `src/hooks/usePermission.ts`
- `src/components/RoleBasedRoute.tsx`
- `src/components/PermissionGuard.tsx`
